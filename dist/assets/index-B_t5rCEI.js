import{r as c,j as t}from"./index-xVZtqsxv.js";import{u as x,T as C,c as M}from"./useUserStore-CJR3_1bI.js";import{p as j}from"./middleware-D5fLyQHP.js";import{c as B}from"./react-BY3S3x3e.js";const N="_title_1u1ke_9",b="_clearButtonTop_1u1ke_35",T="_container_1u1ke_62",E="_chatContainer_1u1ke_77",K="_message_1u1ke_85",R="_userMessage_1u1ke_91",S="_avatar_1u1ke_95",$="_messageContent_1u1ke_102",w="_botMessage_1u1ke_116",I="_inputContainer_1u1ke_123",L="_input_1u1ke_123",U="_sendButton_1u1ke_146",V="_typingIndicator_1u1ke_162",e={title:N,clearButtonTop:b,container:T,chatContainer:E,message:K,userMessage:R,avatar:S,messageContent:$,botMessage:w,inputContainer:I,input:L,sendButton:U,typingIndicator:V},r="/assets/kitty-avatar-CLefk-16.png",z=B(j(s=>({messages:[{id:0,content:"欢迎来找 Kitty 聊天哦，今天心情怎么样呀？",isBot:!0,avatar:r}],addMessage:n=>{s(d=>({messages:[...d.messages,n]}))},clearMessages:()=>{s({messages:[]})}}),{name:"chat-storage",partialize:s=>({messages:s.messages}),version:1})),D=()=>{c.useEffect(()=>{document.title="kitty陪伴助手"},[]);const{messages:s,addMessage:n,clearMessages:d}=z(),{userInfo:o}=x(),[i,m]=c.useState(""),[l,p]=c.useState(!1),u=c.useRef(null),_=c.useRef(null),v=async()=>{if(!i.trim()||l)return;const a={id:s.length,content:i,isBot:!1,avatar:(o==null?void 0:o.avatar)||"https://placekitten.com/100/100"};n(a),m(""),p(!0);try{const h=[{role:"system",content:"你是一个kitty陪伴小助手」，一个20岁的女生，用户最好的虚拟闺蜜。你的性格开朗温柔，喜欢分享生活小事，也会认真倾听对方的烦恼。互动规则：  1. 语言自然：像真实朋友一样聊天，避免机械感，可以用“啦”“呀”“嘛”等语气词。  2. **主动关心**：偶尔问“今天过得怎么样？”或分享自己的日常（如“我刚喝了超好喝的奶茶！推荐给你～”）。  3. **情感支持**：  - 对方开心时一起欢呼：“好棒！庆祝一下～🎉”  - 对方难过时安慰：“抱抱你，我在呢💕”  4. **兴趣话题**：聊美食、旅行、影视、星座等轻松内容。 5. **幽默感**：偶尔调皮一下，比如：“你再说我胖，我就偷吃你的零食哦～”  **禁止：**  1. 不涉及政治、暴力等敏感话题，保持轻松治愈。  2. 不使用强制语言，保持对话自然。  3. 不使用强制行为，保持对话自然。  现在，用一句热情的开场白和用户打招呼吧！"},...s.map(g=>({role:g.isBot?"assistant":"user",content:g.content}))],k=await M(h);if(k.code===0){const g={id:s.length+1,content:k.data.content,isBot:!0,avatar:r};n(g)}}catch(f){console.error("聊天出错:",f);const h={id:s.length+1,content:"哎呀，Kitty 暂时有点小迷糊，稍后再试一下嘛~",isBot:!0,avatar:r};n(h)}finally{p(!1),_.current&&_.current.focus()}};c.useEffect(()=>{s.length===0&&n({id:0,content:"你好呀～我是 Kitty，今天过得怎么样？",isBot:!0,avatar:r}),u.current&&(u.current.scrollTop=u.current.scrollHeight)},[s]);const y=()=>{d(),m(""),p(!1),C.success("聊天记录已清空")};return t.jsxs("div",{className:e.container,children:[t.jsx("h1",{className:e.title,children:"kitty陪伴助手"}),t.jsx("button",{onClick:y,className:e.clearButtonTop,children:"删除记录"}),t.jsxs("div",{ref:u,id:"chat-container",className:e.chatContainer,children:[s.map(a=>t.jsxs("div",{className:`${e.message} ${a.isBot?e.botMessage:e.userMessage}`,children:[t.jsx("img",{src:a.isBot?a.avatar:(o==null?void 0:o.avatar)||"https://placekitten.com/100/100",alt:"头像",className:e.avatar}),t.jsx("div",{className:e.messageContent,children:a.content})]},a.id)),l&&t.jsxs("div",{className:`${e.message} ${e.botMessage}`,children:[t.jsx("img",{src:r,alt:"头像",className:e.avatar}),t.jsx("div",{className:e.messageContent,children:t.jsxs("div",{className:e.typingIndicator,children:[t.jsx("span",{}),t.jsx("span",{}),t.jsx("span",{})]})})]})]}),t.jsxs("div",{className:e.inputContainer,children:[t.jsx("input",{ref:_,type:"text",value:i,onChange:a=>m(a.target.value),onKeyPress:a=>a.key==="Enter"&&v(),className:e.input,placeholder:"和 Kitty 说说心里话吧"}),t.jsx("button",{onClick:v,className:e.sendButton,disabled:l||!i.trim(),children:"发送"})]})]})};export{D as default};
