import{r as h,j as t}from"./index-_8CRas7D.js";import{a as u,S as p}from"./index-DJ5whZ-l.js";import{c as x}from"./react-BVew-p-W.js";import{u as j}from"./useTitle-uU9Zhg01.js";import"./ArrowLeft-Cj23IyZF.js";const L="_container_cdlbu_1",H="_wrapper_cdlbu_27",N="_suggestWrapper_cdlbu_65",S="_title_cdlbu_83",b="_hot_cdlbu_105",f="_historyList_cdlbu_105",v="_suggestContainer_cdlbu_127",w="_list_cdlbu_141",I="_item_cdlbu_159",B="_history_cdlbu_105",C="_historyItem_cdlbu_239",W="_clearBtn_cdlbu_279",E="_empty_cdlbu_327",s={container:L,wrapper:H,suggestWrapper:N,title:S,hot:b,historyList:f,suggestContainer:v,list:w,item:I,history:B,historyItem:C,clearBtn:W,empty:E},J=async()=>{try{const a=(await u.get("/hotList")).data;return a.code===0?a:{code:-1,data:[]}}catch(r){return console.error("获取热门列表失败:",r),{code:-1,data:[]}}},O=async r=>{try{const i=(await u.get("/suggest",{params:{keyword:r},timeout:3e3})).data;return i.code===0?i:{code:-1,data:[]}}catch(a){return console.error("获取搜索建议失败:",a),{code:-1,data:[]}}},Q=x((r,a)=>{const i=JSON.parse(localStorage.getItem("searchHistory")||"[]");return{hotList:[],suggestList:[],searchHistory:i,enterLoading:!1,setHotList:async()=>{const c=await J();r({hotList:c.data})},setSuggestList:async c=>{const o=await O(c);r({suggestList:o.data})},addHistory:c=>{if(!c)return;const{searchHistory:o}=a(),l=[c,...o.filter(n=>n!==c)].slice(0,10);r({searchHistory:l}),localStorage.setItem("searchHistory",JSON.stringify(l))},clearHistory:()=>{r({searchHistory:[]}),localStorage.removeItem("searchHistory")}}}),z=()=>{j("搜索");const[r,a]=h.useState(""),{suggestList:i,setSuggestList:c,hotList:o,setHotList:l,searchHistory:n,addHistory:g,clearHistory:m}=Q();h.useEffect(()=>{l()},[]);const y=e=>{a(e),e&&(g(e),c(e))},_={display:r===""?"none":"block"};return t.jsx("div",{className:s.container,children:t.jsxs("div",{className:s.wrapper,children:[t.jsx(p,{handleQuery:y,isSearchPage:!0}),t.jsx("div",{className:s.suggestContainer,children:t.jsx("div",{className:s.list,style:_,children:i.map((e,d)=>t.jsx("div",{className:s.item,children:e},e))})}),t.jsxs("div",{className:s.suggestWrapper,children:[t.jsx("h1",{className:s.title,children:"热门推荐"}),t.jsx("div",{className:s.hot,children:o&&o.map((e,d)=>t.jsx("div",{className:s.item,children:e.keyword},e.id))}),t.jsxs("div",{className:s.history,children:[t.jsx("h2",{children:"搜索历史"}),n.length>0?t.jsxs(t.Fragment,{children:[t.jsx("ul",{className:s.historyList,children:n&&n.map((e,d)=>t.jsx("li",{className:s.historyItem,children:e},d))}),t.jsx("button",{className:s.clearBtn,onClick:m,children:"清空历史"})]}):t.jsx("p",{className:s.empty,children:"暂无搜索历史"})]})]})]})})};export{z as default};
