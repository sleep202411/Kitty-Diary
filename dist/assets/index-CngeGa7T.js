import{r as c,j as s}from"./index-7FYdZ7LW.js";import{u as b}from"./useTitle-I86CEnKF.js";import{u as C,T as M,c as j}from"./useUserStore-DVr0vhsj.js";import{p as B}from"./middleware-Bf4wNvVB.js";import{c as N}from"./react--KxBXeKu.js";const k="_title_bc2sa_9",T="_clearButtonTop_bc2sa_35",I="_container_bc2sa_62",K="_chatContainer_bc2sa_77",R="_message_bc2sa_85",S="_userMessage_bc2sa_91",E="_avatar_bc2sa_95",$="_messageContent_bc2sa_102",w="_botMessage_bc2sa_116",L="_inputContainer_bc2sa_123",U="_input_bc2sa_123",V="_sendButton_bc2sa_146",z="_typingIndicator_bc2sa_162",t={title:k,clearButtonTop:T,container:I,chatContainer:K,message:R,userMessage:S,avatar:E,messageContent:$,botMessage:w,inputContainer:L,input:U,sendButton:V,typingIndicator:z},o="/assets/kitty-avatar-CLefk-16.png",A=N(B(e=>({messages:[{id:0,content:"欢迎来找 Kitty 聊天哦，今天心情怎么样呀？",isBot:!0,avatar:o}],addMessage:n=>{e(g=>({messages:[...g.messages,n]}))},clearMessages:()=>{e({messages:[]})}}),{name:"chat-storage",partialize:e=>({messages:e.messages}),version:1})),G=()=>{b("kitty陪伴助手");const{messages:e,addMessage:n,clearMessages:g}=A(),{userInfo:d}=C(),[r,m]=c.useState(""),[i,p]=c.useState(!1),l=c.useRef(null),_=c.useRef(null),f=async()=>{if(!r.trim()||i)return;const a={id:e.length,content:r,isBot:!1,avatar:(d==null?void 0:d.avatar)||"https://placekitten.com/100/100"};n(a),m(""),p(!0);try{const h=[{role:"system",content:"你是一个kitty陪伴小助手」，一个20岁的女生，用户最好的虚拟闺蜜。你的性格开朗温柔，喜欢分享生活小事，也会认真倾听对方的烦恼。互动规则：  1. 语言自然：像真实朋友一样聊天，避免机械感，可以用“啦”“呀”“嘛”等语气词。  2. **主动关心**：偶尔问“今天过得怎么样？”或分享自己的日常（如“我刚喝了超好喝的奶茶！推荐给你～”）。  3. **情感支持**：  - 对方开心时一起欢呼：“好棒！庆祝一下～🎉”  - 对方难过时安慰：“抱抱你，我在呢💕”  4. **兴趣话题**：聊美食、旅行、影视、星座等轻松内容。 5. **幽默感**：偶尔调皮一下，比如：“你再说我胖，我就偷吃你的零食哦～”  **禁止：**  1. 不涉及政治、暴力等敏感话题，保持轻松治愈。  2. 不使用强制语言，保持对话自然。  3. 不使用强制行为，保持对话自然。  现在，用一句热情的开场白和用户打招呼吧！"},...e.map(u=>({role:u.isBot?"assistant":"user",content:u.content}))],y=await j(h);if(y.code===0){const u={id:e.length+1,content:y.data.content,isBot:!0,avatar:o};n(u)}}catch(v){console.error("聊天出错:",v);const h={id:e.length+1,content:"哎呀，Kitty 暂时有点小迷糊，稍后再试一下嘛~",isBot:!0,avatar:o};n(h)}finally{p(!1),_.current&&_.current.focus()}};c.useEffect(()=>{e.length===0&&n({id:0,content:"你好呀～我是 Kitty，今天过得怎么样？",isBot:!0,avatar:o}),l.current&&(l.current.scrollTop=l.current.scrollHeight)},[e]);const x=()=>{g(),m(""),p(!1),M.success("聊天记录已清空")};return s.jsxs("div",{className:t.container,children:[s.jsx("h1",{className:t.title,children:"kitty陪伴助手"}),s.jsx("button",{onClick:x,className:t.clearButtonTop,children:"删除记录"}),s.jsxs("div",{ref:l,id:"chat-container",className:t.chatContainer,children:[e.map(a=>s.jsxs("div",{className:`${t.message} ${a.isBot?t.botMessage:t.userMessage}`,children:[s.jsx("img",{src:a.avatar,alt:"头像",className:t.avatar}),s.jsx("div",{className:t.messageContent,children:a.content})]},a.id)),i&&s.jsxs("div",{className:`${t.message} ${t.botMessage}`,children:[s.jsx("img",{src:o,alt:"头像",className:t.avatar}),s.jsx("div",{className:t.messageContent,children:s.jsxs("div",{className:t.typingIndicator,children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]})]}),s.jsxs("div",{className:t.inputContainer,children:[s.jsx("input",{ref:_,type:"text",value:r,onChange:a=>m(a.target.value),onKeyPress:a=>a.key==="Enter"&&f(),className:t.input,placeholder:"和 Kitty 说说心里话吧"}),s.jsx("button",{onClick:f,className:t.sendButton,disabled:i||!r.trim(),children:"发送"})]})]})};export{G as default};
